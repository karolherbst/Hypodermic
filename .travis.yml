language: cpp
compiler:
  - gcc
  - clang
env:
  global:
    - BT=SHARED
  matrix:
    - BV=1.46
    - BV=1.48
    - BV=1.54
matrix:
  include:
    - compiler: gcc
      env: BT=SHARED CFLAGS=--coverage CXXFLAGS=--coverage COVERAGE=1
      fast_finish: true
before_install:
  - sudo add-apt-repository ppa:boost-latest/ppa -y
  - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
  - sudo apt-get update -qq
install:
  - sudo apt-get install libboost${BV}-dev libboost-signals${BV}-dev libboost-system${BV}-dev libboost-test${BV}-dev
  - if [ "$CXX" = "g++" -a "$BV" = "1.54" ]; then sudo apt-get install -qq g++-4.8; fi
  - if [ "$CXX" = "g++" -a "$BV" = "1.54" ]; then export CXX="g++-4.8" CC="gcc-4.8"; fi
  - if [ -n "$COVERAGE" ]; then sudo pip install cpp-coveralls --use-mirrors; fi
script:
  - cmake . -DHYPODERMIC_BUILD_TYPE=$BT
  - make -j4
after_success:
  - if [ -n "$COVERAGE" ]; then coveralls --gcov gcov-4.8 --exclude CMakeFiles --exclude-pattern 'CMake[^\.]*\.c(?:pp)?' --exclude-pattern '[^\.]*\.h' > /dev/null; fi
